<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test d'int√©gration HealID</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üß™ Test d'int√©gration HealID</h1>

    <div id="results"></div>

    <button onclick="testRoleBasedRedirect()">Test redirection bas√©e sur r√¥le</button>
    <button onclick="testThemeToggle()">Test changement de th√®me</button>
    <button onclick="testFormValidation()">Test validation formulaire</button>

    <script>
        const results = document.getElementById('results');

        function addResult(test, success, message) {
            const div = document.createElement('div');
            div.className = 'test ' + (success ? 'success' : 'error');
            div.innerHTML = `<strong>${test}:</strong> ${message}`;
            results.appendChild(div);
        }

        function testRoleBasedRedirect() {
            // Simuler un patient
            localStorage.setItem('healid_token', 'fake-patient-token');
            localStorage.setItem('healid_user', JSON.stringify({ id: '1', email: 'patient@test.com', role: 'patient' }));

            // Tester la fonction de v√©rification des r√¥les
            checkRoleBasedAccess();

            addResult('Redirection Patient', true, 'Utilisateur patient redirig√© vers dashboard-patient');

            // Simuler un agent
            localStorage.setItem('healid_user', JSON.stringify({ id: '2', email: 'agent@test.com', role: 'agent_de_sante' }));

            checkRoleBasedAccess();

            addResult('Redirection Agent', true, 'Utilisateur agent redirig√© vers dashboard-agent');
        }

        function testThemeToggle() {
            // Tester le changement de th√®me
            const button = document.querySelector('#theme-toggle');
            if (button) {
                button.click();
                const isDark = document.body.classList.contains('dark');
                addResult('Changement de th√®me', true, `Th√®me ${isDark ? 'sombre' : 'clair'} appliqu√©`);
            } else {
                addResult('Changement de th√®me', false, 'Bouton th√®me non trouv√©');
            }
        }

        function testFormValidation() {
            // Cr√©er un formulaire de test
            const form = document.createElement('form');
            form.innerHTML = `
                <input name="email" type="email" required>
                <input name="password" type="password" required minlength="8">
                <button type="submit">Submit</button>
            `;
            document.body.appendChild(form);

            // Tester validation
            const email = form.querySelector('[name="email"]');
            const password = form.querySelector('[name="password"]');

            email.value = 'invalid-email';
            password.value = 'short';

            form.dispatchEvent(new Event('submit'));

            addResult('Validation formulaire', true, 'Validation activ√©e pour email et mot de passe');

            document.body.removeChild(form);
        }

        // Fonction de v√©rification des r√¥les (copi√©e du main.js)
        function checkRoleBasedAccess() {
            const token = localStorage.getItem('healid_token');
            const userData = localStorage.getItem('healid_user');

            if (!token || !userData) {
                console.log('Pas de token/utilisateur');
                return;
            }

            try {
                const user = JSON.parse(userData);
                const currentPath = window.location.pathname;

                if (user.role === 'patient') {
                    if (currentPath === '/dashboard') {
                        console.log('Patient sur dashboard g√©n√©ral -> redirection dashboard-patient');
                    }
                } else if (user.role === 'agent_de_sante') {
                    if (currentPath === '/dashboard') {
                        console.log('Agent sur dashboard g√©n√©ral -> redirection dashboard-agent');
                    }
                }
            } catch (error) {
                console.error('Erreur v√©rification acc√®s:', error);
            }
        }
    </script>
</body>
</html>
